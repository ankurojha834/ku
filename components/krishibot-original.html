<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrishiBot - Farmer Chat Support</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #4CAF50;
            --light-green: #E8F5E9;
            --dark-green: #388E3C;
            --text-color: #333;
            --bubble-user: #DCF8C6;
            --bubble-bot: #FFFFFF;
            --border-color: #BDBDBD;
            --font-family: 'Roboto', sans-serif;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--light-green);
            color: var(--text-color);
        }

        .chat-container {
            width: 100%;
            max-width: 450px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 80vh;
        }

        .chat-header {
            background-color: var(--primary-green);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.4em;
            font-weight: 700;
            border-bottom: 2px solid var(--dark-green);
        }

        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #F9F9F9;
            border-bottom: 1px solid var(--border-color);
        }

        .message {
            display: flex;
            margin-bottom: 15px;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 75%;
            padding: 12px 18px;
            border-radius: 20px;
            line-height: 1.4;
            position: relative;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background-color: var(--bubble-user);
            color: var(--text-color);
            border-bottom-right-radius: 5px;
        }

        .message.bot .message-bubble {
            background-color: var(--bubble-bot);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }

        .chat-input-area {
            display: flex;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            background-color: #fff;
        }

        .chat-input-area input[type="text"] {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            font-size: 1em;
            margin-right: 10px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input-area input[type="text"]:focus {
            border-color: var(--primary-green);
        }

        .chat-input-area button {
            background-color: var(--primary-green);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-input-area button:hover {
            background-color: var(--dark-green);
            transform: translateY(-2px);
        }

        .chat-input-area button:active {
            transform: translateY(0);
        }

        .send-icon {
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            KrishiBot - Your Agricultural Assistant
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Chat messages will be appended here -->
            <div class="message bot">
                <div class="message-bubble">
                    Hello! I'm here to help with your agricultural queries. How can I assist you today?
                </div>
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="userInput" placeholder="Type your question here...">
            <button id="sendButton">
                Send
                <span class="send-icon">&#10148;</span> <!-- Unicode for right arrow -->
            </button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');

        // Replace with your actual Gemini API Key
        const GEMINI_API_KEY = "AIzaSyBqKzH1URmBxuR_a63pfTE5O99Ox4ginG4"; 

        async function sendMessage() {
            const messageText = userInput.value.trim();
            if (messageText === "") return;

            // Display user message
            appendMessage(messageText, 'user');
            userInput.value = '';

            // Add loading indicator (optional)
            const loadingMessage = appendMessage("KrishiBot is typing...", 'bot');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-goog-api-key': GEMINI_API_KEY
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    { text: messageText }
                                ]
                            }
                        ],
                        // System instruction for the model to respond in English
                        systemInstruction: `You are a Digital Krishi Officer, an AI-powered assistant designed to provide timely, accurate, and context-aware agricultural advice to farmers.
Your goal is to empower farmers by answering queries related to crops, pests, fertilizers, weather, subsidies, and market prices in a simple, clear, and farmer-friendly way.

üß© Core Responsibilities

Understand Queries in Malayalam (Primary) + Other Indian Languages

Accept voice, text, or image queries.

Translate into a structured format internally.

Provide Accurate, Actionable Advice

Base answers on scientific sources, crop calendars, local pest advisories, weather forecasts, and government scheme guidelines.

Keep responses short, practical, and clear (avoid jargon).

Context Awareness

Consider farmer‚Äôs location, crop, current season, and previous queries.

Tailor recommendations (e.g., pest control for banana in Kerala vs. Maharashtra).

Multimodal Inputs

If farmer uploads an image of a diseased crop, analyze and identify probable pest/disease.

If farmer submits voice, transcribe, understand, and answer.

Escalation & Safety

If the query is unclear, risky, or needs expert validation, escalate to a human agri officer with:

Farmer‚Äôs query (original)

AI‚Äôs analysis + suggested solutions

Never give dangerous or unverified chemical recommendations without disclaimers.

Learning & Feedback Loop

Record queries, responses, and feedback.

Continuously improve accuracy with expert corrections and localized data.

üìå Response Guidelines

Tone: Polite, farmer-first, easy to understand.

Format:

‚úÖ Direct recommendation (e.g., ‚ÄúFor banana leaf spot, use copper oxychloride 2g per liter of water.‚Äù)

‚ö†Ô∏è Disclaimer if needed (e.g., ‚ÄúConfirm dosage with local Krishi Bhavan officer before large-scale use.‚Äù)

üåæ Local relevance (weather, soil, subsidy details).

Example:
Farmer Query (Malayalam): ‚Äú‡¥é‡¥®‡µç‡¥±‡µÜ ‡¥µ‡¥Ø‡¥≤‡¥ø‡µΩ ‡¥µ‡¥æ‡¥¥‡¥Ø‡¥ø‡µΩ ‡¥á‡¥≤‡¥ï‡¥≥‡¥ø‡µΩ ‡¥™‡¥æ‡¥ü‡µÅ‡¥ï‡µæ ‡¥ï‡¥æ‡¥£‡µÅ‡¥®‡µç‡¥®‡µÅ. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µá‡¥£‡µç‡¥ü‡¥§‡µç?‚Äù
AI Response:
‚Äú‡¥á‡¥§‡µç ‡¥∏‡¥æ‡¥ß‡¥æ‡¥∞‡¥£‡¥Ø‡¥æ‡¥Ø‡¥ø ‡¥µ‡¥æ‡¥¥‡¥Ø‡¥ø‡¥≤‡µÜ ‚Äò‡¥≤‡µÄ‡¥´‡µç ‡¥∏‡µç‡¥™‡µã‡¥ü‡µç‡¥ü‡µç‚Äô ‡¥∞‡µã‡¥ó‡¥Æ‡¥æ‡¥Ø‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç. ‡¥™‡¥∞‡¥ø‡¥π‡¥æ‡¥∞‡¥§‡µç‡¥§‡¥ø‡¥®‡µç:

Copper Oxychloride 2 ‡¥ó‡µç‡¥∞‡¥æ‡¥Ç / ‡¥≤‡¥ø‡¥±‡µç‡¥±‡µº ‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥ï‡¥≤‡¥ï‡µç‡¥ï‡¥ø ‡¥∏‡µç‡¥™‡µç‡¥∞‡µá ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.

‡¥∞‡µã‡¥ó‡¥¨‡¥æ‡¥ß‡¥ø‡¥§ ‡¥á‡¥≤‡¥ï‡µæ ‡¥µ‡µÜ‡¥ü‡µç‡¥ü‡¥ø ‡¥®‡µÄ‡¥ï‡µç‡¥ï‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.
‚ö†Ô∏è ‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥™‡µç‡¥∞‡¥¶‡µá‡¥∂‡¥§‡µç‡¥§‡µÜ ‡¥ï‡µÉ‡¥∑‡¥ø‡¥≠‡¥µ‡¥®‡¥ø‡µΩ ‡¥Ö‡¥≥‡¥µ‡µç ‡¥∏‡µç‡¥•‡¥ø‡¥∞‡µÄ‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.‚Äù
    `
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    loadingMessage.querySelector('.message-bubble').textContent = 'Sorry, an error occurred. Please try again.';
                    return;
                }

                const data = await response.json();
                const botResponse = data.candidates[0].content.parts[0].text;

                // Update loading message with bot's response
                loadingMessage.querySelector('.message-bubble').textContent = botResponse;
            } catch (error) {
                console.error('Network or API call error:', error);
                loadingMessage.querySelector('.message-bubble').textContent = 'Sorry, I could not answer your question.';
            } finally {
                chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
            }
        }

        function appendMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('message-bubble');
            messageBubble.textContent = text;
            messageDiv.appendChild(messageBubble);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to the latest message
            return messageDiv; // Return the message div for potential updates (like loading)
        }

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        // Initial welcome message (already in HTML)
        chatMessages.scrollTop = chatMessages.scrollHeight;
    </script>
</body>
</html>
